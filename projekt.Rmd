---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Tina Bertok"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
#tu smo pobrisali shiny da nam ne dela problemov
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

V svojem projektu se bom osredotočila na sklenitve zakonskih zvez v Sloveniji. Analizirala bom starost ženina in neveste, njun zakonski stan ter datum poroke (ugotoviti bom poskušala v katerem mesecu se poroča največ ljudi). Podrobneje si bom ogledala tudi število porok glede na posamezne slovenske regije in to v nadaljnih fazah vizualizirala s pomočjo zemljevida. Kot dodatno spremenljivko bi lahko uporabila tudi istospolne partnerske skupnosti.
***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozila sem podatke o porokah v obliki CSV s statističnega urada. Podatke imamo v petih razpredelnicah v obliki *tidy data*.

1. `istospolne` - podatki o istospolnih partnerskih skupnostih
  - `spol` - spremenljivka: partnerska skupnost med dvema moškima ali med dvema ženskama (neurejen faktor),
  - `leto` - spremenljivka: leto v katerem so bili podatki izmerjeni,
  - `stevilo` - meritev: število sklenjenih istospolnih skupnosti 

2. `meseci` - podatki o porokah v različnih mesecih
  - `leto` - spremenljivka: leto v katerem so bili podatki izmerjeni,
  - `mesec` - spremenljivka: mesec, v katerem so se ljudje poročili,
  - `stevilo` - meritev: število porok v posameznem mesecu.
  
3. `regije` - podatki o porokah po slovenskih regijah
  - `leto` - spremenljivka: leto v katerem so bili podatki izmerjeni,
  - `regija` - meritev: število porok sklenjenih v posamezni regiji.
  
4. `starost` - podatki o starosti ženina in neveste
  - `leto` - spremenljivka: leto v katerem so bili podatki izmerjeni,
  - `starost zenina` - meritev: starost ženina ob poroki,
  - `starost neveste` - meritev: starost neveste ob poroki.
  
5. `stan` - podatki o zakonskem stanu ženina in neveste pred poroko
 
  - `stan zenina` - spremenljivka: zakonski stan ženina pred poroko(samski, vdovec ali razvezan),
  - `stan neveste` - spremenljivka: zakonski stan neveste pred poroko(samska, vdova ali razvezana).
  - `leto` - spremenljivka: leto v katerem so bili podatki izmerjeni,
  - `stevilo` - meritev: število porok.
  
  
 
**Opomba**: Problem sem imela z zapisom decimalne pike pri starosti ženina in nevest, a sem ga rešila z preoblikovanjem osnovne datoteke. 





Spodnji graf prikazuje 

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x = naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```
V fazi vizualizacije sem se odločila narisati 5 grafov in zemljevid. Podatkov je manj, a so ti po mojem mnenju bolj relavantni. 

Prvi graf prikazuje kako se je število istosplonih porok spreminjalo skozi leta. KOt lahko vidimo, so podatki dostopni šele od leta 2006 naprej, saj smo takrat sprejeli zakon, ki dovoljuje poročanje istospolnih parov. Število zakonov z leti narašča, kar je pričakovano, saj je to v zadnjih letih postalo nekaj naravnega. 
Presenetil pa me je podatek, da je skoraj ves čas višje število sklenjenih zakonskih zvez med moškima, kot med ženskama saj bi sama trdila ravno obratno. 
print(graf1)

Drugi graf nam prikazuje število porok po mesecih. Ker bi bilo drugače podatkov za vsa leta preveč, sem se odločila narediti še eno tabelo v kateri sem izračunala povprečje porok za vsak mesec in nato na podlagi te tabele narisala graf. Največ ljudi se poroči...



Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data = left_join(zemljevid, povprecja, by = c("OB_UIME" = "obcina")),
                        aes(x = long, y = lat, group = group, fill = povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill = guide_colorbar(title = "Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina = names(skupine),
                                     skupina = factor(skupine)), by = "obcina")
, aes(x = povrsina, y = naselja, color = skupina, size = prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color = guide_legend(title = "Skupina"),
         size = guide_legend(title = "Prebivalci (* 1000)"))
```

***

```{r shiny, echo = FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
